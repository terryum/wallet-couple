# Wallet Card Dashboard - 테스트 계획서

## 1. 테스트 개요

### 1.1 목적
프론트엔드와 백엔드가 정상적으로 연동되어 사용자 시나리오대로 작동하는지 검증

### 1.2 테스트 환경
- 개발 서버: http://localhost:3001
- 샘플 데이터: `sample-data/` 폴더 내 카드 명세서 파일들
- Supabase 연결 상태 확인 필요

### 1.3 최종 업데이트
- 2025-12-29

---

## 2. 사전 확인 사항

### 2.1 환경 변수 확인
- [x] `.env` 파일에 `SUPABASE_URL` 설정 확인
- [x] `.env` 파일에 `SUPABASE_KEY` 설정 확인
- [x] `.env` 파일에 `ANTHROPIC_API_KEY` 설정 확인
- [x] Supabase에 `transactions` 테이블 생성 확인

### 2.2 서버 상태 확인
- [x] `npm run dev -- -p 3001` 정상 실행 확인
- [x] 브라우저에서 http://localhost:3001 접속 확인
- [x] 콘솔에 에러 없는지 확인

---

## 3. 단위 테스트 현황

### 3.1 데이터 로더 테스트 (48개 전체 통과)

| 테스트 파일 | 테스트 수 | 상태 |
|------------|----------|------|
| hyundai.test.ts | 16 | ✅ 통과 |
| samsung.test.ts | 7 | ✅ 통과 |
| lotte.test.ts | 7 | ✅ 통과 |
| kb.test.ts | 8 | ✅ 통과 |

### 3.2 테스트 실행 명령어
```bash
npm run test:run
```

---

## 4. 기능별 테스트 케이스

### 4.1. 메인 페이지 (내역 화면) - 빈 상태

| # | 테스트 항목 | 예상 결과 | 상태 |
|---|------------|----------|------|
| 1.1 | 페이지 로드 | "내역이 없습니다" 메시지 표시 | ✅ |
| 1.2 | 빈 상태 "명세서 업로드" 버튼 클릭 | 파일 선택 다이얼로그 열림 | ✅ |
| 1.3 | 헤더 "업로드" 버튼 클릭 | 파일 선택 다이얼로그 열림 | ✅ |
| 1.4 | 월 선택기 좌우 화살표 | 월이 변경됨 | ✅ |
| 1.5 | 남편/아내 토글 | 선택된 버튼 스타일 변경 | ✅ |

### 4.2. 파일 업로드 기능

| # | 테스트 항목 | 예상 결과 | 상태 |
|---|------------|----------|------|
| 2.1 | 현대카드 파일 업로드 | 로딩 → 완료 토스트 표시 | ✅ |
| 2.2 | 삼성카드 파일 업로드 | 로딩 → 완료 토스트 표시 | ✅ |
| 2.3 | 롯데카드 파일 업로드 | 로딩 → 완료 토스트 표시 | ✅ |
| 2.4 | KB카드 파일 업로드 | 로딩 → 완료 토스트 표시 | ✅ |
| 2.5 | 업로드 후 리스트 갱신 | 거래 내역 표시 | ✅ |
| 2.6 | 중복 파일 업로드 | "중복 N건 제외" 메시지 | ✅ |
| 2.7 | 파일별 진행 상태 표시 | 각 파일의 처리 상태 표시 | ✅ |

### 4.3. 거래 내역 표시

| # | 테스트 항목 | 예상 결과 | 상태 |
|---|------------|----------|------|
| 3.1 | 거래 내역 행 표시 | 날짜, 이용처, 카테고리, 금액 표시 | ✅ |
| 3.2 | 월별 총 지출 표시 | 상단에 총 지출 표시 | ✅ |
| 3.3 | 카테고리 필터 클릭 | 해당 카테고리만 필터링 | ✅ |
| 3.4 | 스크롤 동작 | 긴 리스트 스크롤 정상 작동 | ✅ |
| 3.5 | 소계/합계 행 제외 | 파싱 시 제외됨 | ✅ |

### 4.4. 거래 내역 편집

| # | 테스트 항목 | 예상 결과 | 상태 |
|---|------------|----------|------|
| 4.1 | 카테고리 뱃지 클릭 | 바텀시트 열림 | ✅ |
| 4.2 | 카테고리 변경 | 뱃지 색상/텍스트 변경됨 | ✅ |
| 4.3 | 행 Long Press | 편집 모달 열림 | ✅ |
| 4.4 | 거래 내역 수정 | 수정사항 저장 및 반영 | ✅ |
| 4.5 | 거래 내역 삭제 | 리스트에서 제거됨 | ✅ |
| 4.6 | FAB (+) 버튼 클릭 | 빈 편집 모달 열림 | ✅ |

### 4.5. 대시보드 페이지

| # | 테스트 항목 | 예상 결과 | 상태 |
|---|------------|----------|------|
| 5.1 | 대시보드 페이지 로드 | 도넛 차트 표시 | ✅ |
| 5.2 | 좌우 스와이프 | 스택 바 차트로 전환 | ✅ |
| 5.3 | 기간 선택 (3/6/12개월) | 차트 데이터 변경 | ✅ |
| 5.4 | 도넛 차트 섹션 클릭 | 상세 내역 팝업 표시 | ✅ |
| 5.5 | 스택 바 차트 클릭 | 하단 상세 내역 표시 | ✅ |
| 5.6 | 상세 내역 항목 클릭 | 해당 카테고리 팝업 | ✅ |
| 5.7 | 하단 네비게이션 | 내역/분석 페이지 전환 | ✅ |
| 5.8 | 호버 팝업 제거 | 도넛 차트 호버 시 팝업 없음 | ✅ |

### 4.6. AI 카테고리 분류

| # | 테스트 항목 | 예상 결과 | 상태 |
|---|------------|----------|------|
| 6.1 | 업로드 시 자동 분류 | AI가 카테고리 자동 지정 | ✅ |
| 6.2 | 재분류 버튼 클릭 | 전체 재분류 실행 | ✅ |
| 6.3 | 분류 결과 반영 | 차트에 분류된 데이터 표시 | ✅ |

---

## 5. 버그 수정 이력

| 날짜 | 버그 | 원인 | 해결 |
|------|------|------|------|
| 12-27 | .env 프로젝트 불일치 | 잘못된 Supabase URL/Key | MCP로 올바른 프로젝트 확인 후 수정 |
| 12-27 | transactions 테이블 없음 | 미생성 | MCP apply_migration으로 생성 |
| 12-27 | ON CONFLICT 에러 | 부분 유니크 인덱스 비호환 | 개별 insert 방식으로 변경 |
| 12-27 | 빈 상태 업로드 버튼 미작동 | fileInputRef 미연결 | forwardRef + useImperativeHandle 사용 |
| 12-27 | 소계/합계 행이 포함됨 | 파서 필터링 누락 | 모든 파서에 skipKeywords 추가 |
| 12-27 | 현대카드 거래 누락 (30/365건) | 결제원금 컬럼 비어있음 | extractAmount 메서드 추가 |
| 12-27 | 롯데카드 파일 인식 실패 | Sheet1만 확인 | 모든 시트 헤더 확인 |
| 12-27 | 대시보드 차트 데이터 미표시 | total vs total_amount 불일치 | useDashboard 필드 매핑 수정 |
| 12-27 | 업로드 진행 상태 불명확 | 단순 메시지만 표시 | 파일별 상세 진행 상태 UI 추가 |
| 12-29 | 헤더/필터 사이 갭 | 스티키 요소 분리 | 스티키 요소 결합 |
| 12-29 | 막대 차트 클릭 팝업 위치 | 차트 위 팝업 표시 | 아래 상세 영역에 표시로 변경 |
| 12-29 | 현대카드 금액 검증 실패 | 인덱스 7 대신 6 사용 필요 | 금액 추출 우선순위 변경 |
| 12-29 | 가맹점명에서 잘못된 금액 추출 | 뒤에서 찾기 범위 문제 | 검색 범위 제한 (인덱스 4 이상) |

---

## 6. API 테스트

| # | 엔드포인트 | 테스트 방법 | 상태 |
|---|-----------|------------|------|
| A.1 | GET /api/transactions?month=2025-12 | 브라우저/curl | ✅ |
| A.2 | POST /api/upload (FormData) | 파일 업로드 | ✅ |
| A.3 | PATCH /api/transactions/:id | 수정 요청 | ✅ |
| A.4 | POST /api/classify | 재분류 요청 | ✅ |

---

## 7. 테스트 완료 기준

- [x] 모든 단위 테스트 (48개) 통과
- [x] 모든 기능 테스트 케이스 통과
- [x] 발견된 버그 모두 수정
- [x] 재테스트 후 정상 작동 확인

---

*작성일: 2025-12-27*
*최종 업데이트: 2025-12-29*
*테스트 담당: Claude*
